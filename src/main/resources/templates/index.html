<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/head :: assets(pageTitle=${'Product Management System'})}"></th:block>

    <style>
        :root {
            color-scheme: light;
        }

        body {
            font-family: var(--wa-font-sans);
            margin: 0;
            background-color: color-mix(in srgb, var(--wa-color-neutral-100, #f1f5f9) 85%, var(--wa-color-neutral-0, #ffffff) 15%);
            background-image: radial-gradient(1200px circle at 0% 0%, color-mix(in srgb, var(--wa-color-primary-50, #eff6ff) 40%, var(--wa-color-neutral-0, #ffffff) 60%) 0%, transparent 70%),
                              linear-gradient(180deg, color-mix(in srgb, var(--wa-color-neutral-100, #f1f5f9) 80%, var(--wa-color-neutral-0, #ffffff) 20%) 0%, var(--wa-color-neutral-0, #ffffff) 100%);
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--wa-color-neutral-900);
        }

        .page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: min(1120px, 100%);
            margin: 0 auto;
            padding: 0 var(--wa-space-l);
        }

        main {
            flex: 1 0 auto;
        }

        .main-content {
            padding: var(--wa-space-2xl) 0 var(--wa-space-3xl, 6rem);
            display: grid;
            gap: var(--wa-space-xl);
        }

        wa-card.actions-card {
            display: grid;
            gap: var(--wa-space-m);
        }

        wa-button-group.actions-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: var(--wa-space-s);
        }

        .feedback-region {
            min-height: calc(var(--wa-space-xl) + var(--wa-space-s));
        }

        #product-form-container {
            display: grid;
            gap: var(--wa-space-l);
        }

        wa-card.products-card {
            display: grid;
            gap: var(--wa-space-m);
        }

        .table-scroll {
            overflow-x: auto;
            border-radius: var(--wa-border-radius-m);
        }

        .pagination-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: var(--wa-space-m);
            padding: var(--wa-space-m);
            border-radius: var(--wa-border-radius-m);
            border: 1px solid color-mix(in srgb, var(--wa-color-neutral-900) 8%, transparent);
            background-color: color-mix(in srgb, var(--wa-color-neutral-0, #ffffff) 85%, transparent);
        }

        .pagination-bar--hidden {
            display: none;
        }

        .pagination-info {
            font-size: var(--wa-font-size-s);
            color: var(--wa-color-neutral-600);
        }

        .pagination-info strong {
            color: var(--wa-color-neutral-900);
        }

        .pagination-buttons {
            display: flex;
            align-items: center;
            gap: var(--wa-space-xs);
        }

        .pagination-page {
            font-size: var(--wa-font-size-s);
            color: var(--wa-color-neutral-600);
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--wa-color-neutral-0, #ffffff);
        }

        .products-table caption {
            text-align: left;
            padding: var(--wa-space-s) var(--wa-space-m);
            color: var(--wa-color-neutral-500);
            font-size: var(--wa-font-size-s);
        }

        .products-table thead th {
            padding: var(--wa-space-xs) var(--wa-space-m);
            background-color: var(--wa-color-neutral-100, #f1f5f9);
            color: var(--wa-color-neutral-600, #475569);
            font-size: var(--wa-font-size-xs);
            font-weight: var(--wa-font-weight-semibold, 600);
            letter-spacing: 0.04em;
            text-transform: uppercase;
            text-align: left;
        }

        .products-table tbody td {
            padding: var(--wa-space-s) var(--wa-space-m);
            border-top: 1px solid color-mix(in srgb, var(--wa-color-neutral-900) 10%, transparent);
            vertical-align: middle;
        }

        .products-table tbody tr:hover {
            background-color: color-mix(in srgb, var(--wa-color-info-100, #e0f2fe) 40%, transparent);
        }

        .table-actions {
            text-align: right;
            white-space: nowrap;
        }

        .column-heading {
            display: inline-flex;
            align-items: center;
            gap: var(--wa-space-2xs, 0.25rem);
        }

        .table-empty,
        .table-error {
            text-align: center;
            padding: var(--wa-space-xl);
            color: var(--wa-color-neutral-500);
            background-color: color-mix(in srgb, var(--wa-color-neutral-100, #f1f5f9) 60%, transparent);
        }

        .table-error {
            background-color: color-mix(in srgb, var(--wa-color-danger-100, #fee2e2) 80%, transparent);
        }

        .product-title {
            font-weight: var(--wa-font-weight-semibold, 600);
            color: var(--wa-color-neutral-900);
            text-decoration: underline;
            text-underline-offset: 0.2em;
            cursor: pointer;
        }

        .product-title:hover,
        .product-title:focus {
            color: var(--wa-color-primary-600);
        }

        .product-handle {
            font-family: var(--wa-font-mono);
            font-size: var(--wa-font-size-xs);
            color: var(--wa-color-neutral-500);
        }

        .product-price {
            display: inline-flex;
            align-items: baseline;
            gap: var(--wa-space-3xs, 0.25rem);
            font-size: var(--wa-font-size-s);
        }

        .product-price__value {
            color: var(--wa-color-success-600);
            font-weight: var(--wa-font-weight-semibold, 600);
        }

        .product-price__currency {
            font-size: var(--wa-font-size-xs);
            color: var(--wa-color-neutral-500);
        }

        .product-type-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--wa-space-3xs, 0.25rem);
            padding: var(--wa-space-3xs, 0.25rem) var(--wa-space-xs);
            border-radius: var(--wa-border-radius-full, 999px);
            background-color: var(--wa-color-primary-100);
            color: var(--wa-color-primary-700);
            font-size: var(--wa-font-size-xs);
            font-weight: var(--wa-font-weight-medium, 500);
        }

        .product-type-empty {
            color: var(--wa-color-neutral-400);
            font-style: italic;
        }

        .product-created {
            font-family: var(--wa-font-mono);
            font-size: var(--wa-font-size-xs);
            color: var(--wa-color-neutral-500);
        }

        wa-card.form-card {
            display: grid;
            gap: var(--wa-space-l);
        }

        form.product-form {
            display: grid;
            gap: var(--wa-space-l);
        }

        .form-grid {
            display: grid;
            gap: var(--wa-space-xl);
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            align-items: start;
        }

        wa-button-group.form-actions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--wa-space-s);
        }

        wa-button[data-loading] {
            opacity: 0.72;
            pointer-events: none;
        }

        .footer {
            padding: var(--wa-space-2xl) 0;
            text-align: center;
            color: var(--wa-color-neutral-500);
        }

        .footer p {
            margin: 0 0 var(--wa-space-s) 0;
        }

        .htmx-indicator {
            display: none;
        }

        .htmx-request .htmx-indicator {
            display: inline-flex;
        }

        @media (max-width: 768px) {
            .table-scroll {
                border-radius: var(--wa-border-radius-s);
            }
        }
    </style>
</head>
<body class="page">
    <th:block th:replace="~{fragments/hero :: hero(
        eyebrowIcon=${'sparkles'},
        eyebrowText=${'Product Operations'},
        titleIcon=${'box'},
        titleText=${'Product Management System'},
        subtitleText=${'Product management workspace with real-time API sync, fast editing, and Web Awesome components.'},
        metricIcon=${'database'},
        metricHeading=${'Inventory'},
        metricValue=${productCount},
        metricSubtext=${'Products currently in the database'},
        metricValueId=${'product-count'}
    )}"></th:block>

    <main class="container main-content">
        <wa-card class="actions-card">
            <div slot="header">
                <wa-icon name="gear"></wa-icon>
                Workspace Actions
            </div>
            <p>
                Manage your product catalog using Web Awesome powered controls. Load existing entries, sync from the external API, or create new items below.
            </p>
            <wa-button-group class="actions-toolbar">
                <wa-button variant="primary"
                           hx-get="/products"
                           hx-target="#products-table tbody"
                           hx-indicator="#products-loading-indicator">
                    <wa-icon name="table" slot="prefix"></wa-icon>
                    Load Products
                    <wa-spinner id="products-loading-indicator" class="htmx-indicator" style="margin-left: var(--wa-space-xs);"></wa-spinner>
                </wa-button>

                <wa-button variant="success"
                           hx-post="/products/sync"
                           hx-target="#sync-status"
                           hx-indicator="#loading-sync">
                    <wa-icon name="arrow-clockwise" slot="prefix"></wa-icon>
                    Sync from API
                    <wa-spinner id="loading-sync" class="htmx-indicator" style="margin-left: var(--wa-space-xs);"></wa-spinner>
                </wa-button>

                <wa-button variant="default"
                           hx-get="/products/form"
                           hx-target="#product-form-container">
                    <wa-icon name="plus" slot="prefix"></wa-icon>
                    Add Product
                </wa-button>

                <wa-button variant="info" href="/search">
                    <wa-icon name="search" slot="prefix"></wa-icon>
                    Search Products
                </wa-button>
            </wa-button-group>
            <div id="sync-status" class="feedback-region" aria-live="polite"></div>
        </wa-card>

        <div id="product-form-container"></div>

        <wa-card class="products-card">
            <div slot="header">
                <wa-icon name="list"></wa-icon>
                Product Inventory
            </div>
            <div class="table-scroll">
                <table id="products-table" class="products-table">
                    <caption>Products sourced from the local database</caption>
                    <thead>
                        <tr>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="tag"></wa-icon>
                                    Title
                                </span>
                            </th>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="link"></wa-icon>
                                    Handle
                                </span>
                            </th>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="currency-dollar"></wa-icon>
                                    Price
                                </span>
                            </th>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="layers"></wa-icon>
                                    Variants
                                </span>
                            </th>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="collection"></wa-icon>
                                    Type
                                </span>
                            </th>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="calendar"></wa-icon>
                                    Created
                                </span>
                            </th>
                            <th>
                                <span class="column-heading">
                                    <wa-icon name="trash"></wa-icon>
                                    Actions
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="7" class="table-empty">
                                <wa-icon name="info-circle" style="margin-right: var(--wa-space-s);"></wa-icon>
                                Use <strong>Load Products</strong> to display items from the database.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="product-pagination" class="pagination-bar pagination-bar--hidden" aria-live="polite"></div>
        </wa-card>
    </main>

    <footer class="footer">
        <p>
            <wa-icon name="code" style="margin-right: var(--wa-space-s);"></wa-icon>
            Built with Spring Boot, HTMX, Thymeleaf &amp; PostgreSQL
        </p>
        <small>Stack: Java 25 · Gradle 9.1.0 · Spring Boot 3.5.6 · Web Awesome</small>
    </footer>

    <script>
        function toggleLoadingState(event, isLoading) {
            const trigger = event.detail && event.detail.elt ? event.detail.elt.closest('wa-button, button') : null;
            if (trigger) {
                if (isLoading) {
                    trigger.setAttribute('data-loading', 'true');
                } else {
                    trigger.removeAttribute('data-loading');
                }
            }
        }

        document.body.addEventListener('htmx:beforeRequest', function(event) {
            toggleLoadingState(event, true);
        });

        document.body.addEventListener('htmx:afterRequest', function(event) {
            toggleLoadingState(event, false);
        });

        document.body.addEventListener('htmx:afterSwap', function(event) {
            const alerts = event.target.querySelectorAll('wa-alert[open]');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    if (alert && alert.isConnected) {
                        alert.style.transition = 'opacity 0.4s ease';
                        alert.style.opacity = '0';
                        setTimeout(function() {
                            if (alert && alert.isConnected) {
                                alert.remove();
                            }
                        }, 400);
                    }
                }, 5000);
            });
        });
    </script>
</body>
</html>
